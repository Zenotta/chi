image: node:10

stages:
  - install
  - build
  - quality
  - pages

# Install
install:
   stage: install
   script:
      - npm install
   artifacts:
      name: "artifacts"
      untracked: true
      expire_in: 30 mins
      paths:
        - .npm/
        - node_modules/

# Build
build:
  stage: build
  script:
    - CI=false npm run build-storybook -o ./public
  artifacts:
    paths:
      - build
      - public
    expire_in: 60 mins
  dependencies:
    - install

# Unit test
test:unit:
   stage: quality
   script:
      -  npm run test
   dependencies:
      - install

# Pages
pages:
  stage: pages
  cache:
    paths:
    - node_modules/
  artifacts:
    paths:
    - public
  only:
  - master
